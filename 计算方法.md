##### 情感词典构建

我们我们将爬取评论集记为$\mathcal C=\{c_i\}_{i=1}^I$，其中$c_i$为第$i$条评论，$I$为评论的个数；将情感集记为$\mathcal E=\{e_j\}_{j=1}^J$，$e_j$为第$j$种情感，$J$为情感的个数。我们按照下面的步骤构建情感词典：

1. **标注**：对每条评论$c_i$，我们都将其在每种情感$e_j$做标注，判断评论$c_i$是否包含情感$e_j$，若包含则标为1，否则为0，这样就得到了一个标注集$\mathcal A=\left\{a_{ij}\in\{0,1\}\right\}_{i=1,j=1}^{I,J}$，其中$a_{ij}$表示评论$c_i$在情感$e_j$上的标注；

2. **分词**：我们使用自然语言处理中的`viterbi`分词算法，对每一条评论都进行分词，即$e_i={w_{i1},\cdots,w_{iN_i}}$，其中$N_i$表示$c_i$分词后词语的个数，我们将所有词语合并，去除重复项和停用词，这样就获得了一个词典，记为$\mathcal W=\{w_k\}_{k=1}^{K}$，其中$w_k$表示第$k$个词语，$K$表示词语的个数；

3. **统计**：对于每种情感，我们可以统计出每个词语在其中出现的次数$f_{jk}$：
   $$
   f_{jk} = \sum_{i=1}^{I} o_{ki} \times a_{ij}
   $$
   其中$o_{ki}$表示词语是否在评论$c_i$中出现，若出现则为1，否则为0，即：
   $$
   o_{ki} =
   \begin{cases}
   1\qquad\text{ if }w_k \in c_i \\
   0\qquad \text{otherwise}
   \end{cases}
   $$
   而对于每个词$w_k$，我们可以统计出其总共出现的次数$o_k$：
   $$
   o_k = \sum_{i=1}^{I} o_{ki}
   $$

4. **计算**：将词语$w_k$在情感$e_j$中出现的次数$f_{jk}$，除以这个词语出现的总次数$o_k$，就得到了词语$w_k$出现时，它代表的情感是$e_j$的概率$d_{jk}$，即：
   $$
   d_{jk} = P(e_j \mid w_k) = \frac{f_{jk}}{o_k}
   $$
   对字典中的每个词都进行这样的处理，我们就的得到了情感字典$\mathcal D = \{d_{jk}\}_{j=1,k=1}^{J,K}$。



##### 评论情感判定

对于新的评论$c_i$，我们按照下面的步骤对其进行情感的判定：

1. **分词**：对每一条待进行情感判定的评论$c_i$，我们先将其进行分词和去停用词，得到$c_i=\{w_k\}_{k=1}^{K_i}$，其中$w_k$为$c_i$分词后的词语，$K_i$为$c_i$分词及去停用词后的词语的个数；

2. **计算**：根据朴素贝叶斯原理，这个评论包含情感$e_j$上概率，就是其所有分词在这个情感上的累积；而为了消弭极化问题，在计算时乘以了每条评论与长度相关的常数$N$，因此评论$c_i$包含情感$e_j$的概率$p_{ij}$就是：
   $$
   p_{ij} = N^{K_i} \times \prod_{k=1}^{K_i} d_{jk}
   $$

3. **判定**：最后根据$p_{ij}$，选用一个阈值$\tau$来判段评论$c_i$是否包含情感$e_j$。